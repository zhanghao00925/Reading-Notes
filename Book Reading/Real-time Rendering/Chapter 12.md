## Motion Blur

为了绘制可信的时序图片，高帧率以及稳定的帧率是非常重要的。流畅和连续的运动是令人满意的，太低的；帧率会造成运动颠簸。电影以24FPS播放，但是湖南的环境是的人眼对闪烁更加不敏感。更重要的是，电影的帧是天然motion blur的图片，但是实时绘制的不是。

快速移动的物体看起来很不稳定，没有运动模糊，在帧之间“跳跃”了很多像素。这可以被认为是一种走样，但是是在时域上的，motion blur可以被认为是一种时域上的反走样。正如提高显示分辨率可以减少锯齿但不能消除锯齿一样，提高帧速率也不能消除运动模糊。视频游戏的特点是镜头和物体的快速运动，因此运动模糊可以显著改善游戏的视觉效果。30帧的动态模糊效果通常比60帧的效果更好。

运动模糊取决于相对运动。如果一个物体在屏幕上从左到右移动，它在屏幕上就会水平模糊。如果相机跟踪一个移动的物体，物体不会模糊——背景会模糊。

与景深类似，积累一系列图像提供了一种创建动态模糊的方法。当快门打开时，一帧有持续时间。场景在这个时间段的不同时间被渲染，相机和对象被重新定位。合成的图像被混合在一起，形成了一个模糊的图像，其中物体相对于相机的视角在移动。对于实时渲染，这样的过程通常会产生反效果，因为它可以大大降低帧速率。此外，如果对象移动得很快，artifacts就会可见。随机栅格化可以避免多幅图像混合时出现的重影现象，而是产生一些噪声。

如果想要的是运动的暗示，积累的概念可以用一种巧妙的方式。假设一个运动中的模型的八帧被生成并加到一个高精度的缓冲区中，然后取平均值并显示出来。在第9帧，再次渲染和积累模型，但也在这个时候，第1帧的渲染再次执行，并从求和结果中减去。缓冲区现在有8帧的模糊模型，帧2到9。在下一帧，我们减去第二帧，再加上第十帧，同样得到八帧的和，从第三帧到第十帧。这给了一个高度模糊的艺术效果，代价是每帧渲染场景两次。

有几个不同的运动模糊的来源，每个都有方法可以应用于它。这些变化可以分为摄像机方向变化、摄像机位置变化、对象位置变化和对象方向变化，其复杂程度大致依次递增。如果相机保持它的位置，整个世界可以被认为是一个围绕着观众的天空盒子。仅仅是方向的改变就会造成模糊，模糊的方向指向整个图像。给定方向和速度，我们沿着这个方向对每个像素进行采样，速度决定了滤波器的宽度。这种方向性模糊被称为线积分卷积(LIC)。

如果相机的位置发生了变化，视差就会发挥作用，比如，远处的物体移动的速度变慢了，所以模糊也就少了。当相机向前移动时，视差可能会被忽略。径向模糊可能是巨大的，来产生戏剧夸大效果。

【fig 12.18】

Rosado[1509]描述了使用前一帧的相机视图矩阵来计算飞行中的速度。其思想是将像素的屏幕位置和深度转换回世界空间位置，然后使用前一帧的摄像机将这个世界点转换为屏幕位置。这些屏幕空间位置之间的差就是速度矢量velocity vector，它用于模糊该像素的图像。组合的结果可以以四分之一屏幕的大小绘制，既节省像素处理，又滤除了噪声[1428]。

如果物体彼此独立运动，情况就更复杂了。一个直接的，但用处有限的方法是渲染模糊本身。这就是绘制线段来表示运动粒子的基本原理。这个概念可以扩展到其他对象。想象一把剑在空中划过。在刀锋前后，沿刀锋边缘分别添加两个多边形。这些可以动态地建模或生成。这些多边形使用每个顶点的alpha透明度，因此当一个多边形遇到剑的时候，它是完全不透明的，而在多边形的外缘，alpha是完全透明的。这个想法是，模型在运动方向上具有透明度，模拟剑在(假想的)快门打开的部分时间内覆盖这些像素的效果。

这种方法可以用于简单的模型，例如摆动的剑刃，但是纹理、高光和其他特征也应该是模糊的。每个运动的表面都可以被看作是单独的样本。早期的运动模糊方法分散这些样本，通过在运动方向上扩展几何形状。这种几何操作非常昂贵，因此已经开发出了“收集即分散”的方法。对于景深，我们将每个样本扩展到其circle of confusion的半径。对于移动样本，我们将每个样本沿着其在帧中移动的路径拉伸，类似于LIC。快速移动的样本覆盖的面积更大，因此在每个位置上的影响更小。从理论上讲，我们可以在一个场景中提取所有的样本，并将它们画成半透明的线段，按顺序排列。

[fig 12.19]

随着更多的样本被采集，产生的模糊在它的前缘和后缘有一个平滑的透明渐变。

因此需要知道每个像素表面的速度。一个被广泛采用的方法是使用velocity buffer。为了创建这个缓冲区，在模型的每个顶点插入屏幕-空间速度。速度可以通过应用于模型的两个建模矩阵来计算，一个用于前一帧，另一个用于当前帧。顶点着色程序计算位置的差异，并将此向量转换为相对屏幕空间坐标。

【FIG 12.20】

一旦速度缓冲区形成，每个物体在每个像素的速度是已知的。未模糊的图像也被渲染。但是要注意，我们遇到了一个类似之前DOF时的问题，单一的图像不能获得所有数据。对于交互式动态模糊，我们从一个定时序列中取出一个帧，并将其用作代表性图像。我们尽可能地使用这些数据，但所需的所有数据并不总是存在，这可能会造成artifacts。

有了这个帧和速度缓冲器，我们就可以重建物体对每个像素的影响，使用一个“收集即分散”的运动模糊系统。一种方法是:在第一个pass中，为屏幕的每个部分计算最大速度，例如，每个8×8像素块(第23.1节)，存入一个buffer中。第二个pass中，对生成的buffer的3*3区域找到最大值（TBD）。

最后对运动模糊图像进行了计算。与景深类似，对每个像素的邻域进行检测，以确定可能快速移动并重叠像素的样本。不同的是，每个样本都有自己的速度，沿着自己的路径。已经有了一些不同的方法来过滤和混合相关的样本。一种方法是利用最大速度的大小来确定核的方向和宽度。如果该速度小于半像素，则不需要运动模糊[1173]。否则，图像将沿最大速度方向进行采样。注意遮挡在这里很重要，因为它与景深有关。一个在静态对象后面快速移动的模型不应该让它的模糊效果溢出到这个对象之上。如果发现相邻样本的距离足够接近像素的z深度，则认为它是可见的。这些样本混合在一起形成了前景的贡献。

有几种采样和滤波的方法用于改进这种方法的观感。为了避免重影，样本位置随机抖动半个像素[1173]。更多参见【参考文献】。


在电子游戏中，玩家的体验通常不像看电影，而是在他们的直接控制下，以一种不可预知的方式改变视图。在这些情况下，运动模糊有时可能应用不好，导致分散注意力或眩晕。眼动跟踪设备和更高的帧率可能有助于改善运动模糊或完全消除它的应用。

